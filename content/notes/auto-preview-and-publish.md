---
title: 記事を自動的にプレビュー・公開できるようにする
tags:
  - dev
date: 2025-01-11
state: public
---
[[lowering-hurdle-for-writing-and-publishing|さくらもちガーデンで書くためのハードルを低くする試み]]の続き。たぶん残ってるハードルのことを無意識に考えていて、今日お風呂で湯船に入ったときに新しい方法を急に思い付いた。今思ったけど、タイミングが[「Eureka」の元になった話](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%82%A6%E3%83%AC%E3%82%AB)みたいで面白いね。

## 新しい更新のしくみ

![[sketch-of-post-state.svg]]

[tldraw](https://www.tldraw.com/)っていうオンラインのツールを使って、思いついたしくみを図にしてみた。

### 記事の3つの状態

各記事に新しい「状態」プロパティ（`state`）を追加するの。`state`は`draft`、`preview`、`public`の3種類の状態を持っていて、それそれの状態は私が記事をどういう状態にしたいと思っているかを表現したものだと考える。

1. `draft`は、まだ手元に置いて非公開にしておきたい状態。下書きすぎて公開するかまだわからなかったり、見られなくないメモがあったりする状態。
2. `preview`は、まだ下書きや未完成だったりするけど、見ようとすれば見られてもいいかなっていう状態。この状態になったら、さくらもちガーデンでURLに`?preview=yes`のパラメータを追加すると下書きのプレビューが見られる。
3. `public`になったら普通に公開される。

### 自動的に更新する

そして、ポイントなのは、書いた記事のフォルダを自動的にチェックして、記事や状態が更新されたタイミングで、その状態に応じて希望通りの状態に自動的に更新すること。

…って思ってたんだけど、ここまで書いて、`preview`の状態は今のさくらもちガーデンで使ってるフレームワークだと実現できないことに気づいてしまった😢 リニューアルまでは`preview`は諦めて、`draft`と`public`だけで我慢することにしよう…。

というわけで、[自動更新のスクリプトを書いて](https://github.com/sakuramochi0/garden/commit/02bbb55aeeb00a80f366c4728cfc62cad9f23224)、自動的に実行するようにした。これで、記事を書いて、`state: draft`→`state: public`って書き換えるだけで自動的に公開できるようになったはず…！😃

## 1週間経った

気づいたらまた1週間経ってて、記事を書く仕組みを作ってその記事を書いてるだけで、本来書きたいことが書けてない…。

書くだけなら、わざわざ自分で作らなくてもWordPressとか既存のCMSを使えば必要な機能は揃うんだろうけど、こうやって新しい仕組みを作ったり望みどおりに調整したりするのも楽しいから、進みが遅くてもこのまま続けるつもりだよ。

浪川さんの曲とすとぷりの話は、どんなことを書きたいかたまに浮かんでは消えていってるんだけど、実際に書かないとずっと完成しないよ〜。
